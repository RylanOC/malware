# Solutions

## Lab_04-1

1. Set a breakpoint at 0x00401092, what is this sample calling?

   * Kernel32.GetProcAddress
1. What is being called at 0x004010A6? What is the callee doing?
   * It is calling Kernel32.VirtualAlloc
     * Location parameter is `0x0C000000`
     * Size parameter is `0xB000` bytes
     * Protection is `PAGE_EXECUTE_READ_WRITE`
1. What is sub_401360 doing? What about sub_401372 and sub_401388?
   * `0x00401360` calls Kernel32.GetProcAddress
   * `0x00401372` also calls Kernel32.GetProcAddress, but with advapi32
   * `0x00401388` also calls Kernel32.GetProcAddress, but with user32
1. What Windows API functions did the sample import?
   * Some of the imported functions are GetModuleFileNameA, ExitProcess, CopyFileA, GetWindowsDirectoryA, LoadLibraryA, RegCreateKeyA, RegSetKeyValueA, RegCloseKey, and MessageBoxA
1. How did you find the imported functions?
   * We were unable to simply view the imports in a PE viewer like prior labs
   * I found a large list of imported symbols in x64dbg, which included function names
   * Can also set a breakpoint on GetProcAddress to see what functions are asked for via the parameters
1. What does this sample do?
   * The malware copies itself to `C:\Windows\virus.exe`, sets itself to autorun via the registry, then pops up a message box saying `Infected!`



## Lab_04-2

1. What is the address of the win/lose function?
   * `0x00401090` is the address of the function that checks the answer
2. What does this sample do with the user input?
   * It iterates through the bytes and flips the nibbles (so `0x12` becomes `0x21`)
3. What is the address of the encrypted flag?
   * `0x0040303c`
4. Flag?
   * flag{Pra1se_th3_Sun!}



# Things to Change

* We liked malware 1, but we should probably update the slides to talk about the debuggers that are installed with flare
* Malware 2 seemed entirely irrelevant to the point of the week
  * It was literally just a CTF reverse engineering challenge (and not a good one). Would've maybe fit the "advanced static analysis" week than this one
  * We would recommend removing it entirely



# Malicious Behavior

* Copying itself to the Windows directory - 9/10
* Setting the registry to auto-run the aforementioned copy - 4
* Unsolicited message pop up box - 7