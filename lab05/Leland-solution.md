# Lab 5

## Lab_05-1.malware
* What does the malware drop to disk?
  * A keylogger

* How does the malware achieve persistence? Why does this make a great host-based signature?
  * It replaces the Google chrome updater executable. It's a good host-based signature because you can check it to see if it's been modified

* How does the malware ensure more than one instance of itself isn't running on the system at any given time?
  * It uses a mutex

* Name 2 ways the malware tries to hide its presence from the user.
  * Disguises itself as a well known program (Chrome updater)
  * Changes the console window

* Name the 2 major WinAPI calls involved in enabling the key logging.
  * SetWindowsHookExW - Used to register the key-logging function to run whenever a key is pressed
  * SetWinEventHook - Used to register a function that executes whenever the foreground window is changed

* What are the names of the constants passed to each of these WinAPI calls?
  * SetWindowsHookExW: `0xd` - `WH_KEYBOARD_LL`
  * SetWinEventHook: `2` - `WINEVENT_SKIPOWNPROCESS` (apparently it's `WINEVENT_SKIPOWNPROCESS|WINEVENT_OUTOFCONTEXT`, according to the answer key)

* What does the malware do with the collected data?
  * Writes it to a file

## Lab_05-2.malware
* Why does this sample use the internet? Where does it connect to?
  * It connects to `http://malcode.rpis.ec/update_defender` to try to download the actual payload

* How does the malware achieve persistence? Why does this make a great host-based signature?
  * It replaces the Mozilla Maintenance service. It's a good host-based signature because you can check it to see if it's been modified

* Why is the second mutex necessary in this sample?
  * So that only one child window enumeration is running at once

* Briefly describe what SendMessage does
  * Sends a message (built-in Windows signal) to a window or multiple windows

* What are the names and purposes of the 3 constants used (as the 2nd arg to SendMessage) by this sample?
  * 0xd2: `EM_GETPASSWORDCHAR`
  * 0xcc: `EM_SETPASSWORDCHAR`
  * 0xc4: `EM_GETLINE`

* How does this sample steal passwords? How does it differ from the last sample?
  * It goes through each window and reads for password fields in each one. This is different from the last one in that the last one just logged all of the keystrokes

* What does the malware do with the collected data?
  * Writes it to a file

* Things to Change
  * Add a slide on extracting sections using Ghidra. Lab 3 also has an embedded PE payload, so it might be better to add the slide to that one.
  * Add a link for decoding the SetWinEventHook codes: https://source.winehq.org/source/include/winuser.h (still kinda annoying to find in here. need to CTRL+F the function name)
  * Add a link for decoding the Windows message codes: https://wiki.winehq.org/List_Of_Windows_Messages

