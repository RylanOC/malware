# Lab 3

## Lab_03-1.malware
* Did you find any interesting resources? If so, how did you extract it?
  * There was a hidden PE file, some encrypted data, and 2 Microsoft assembly XML sections. I extracted them with `binwalk`

* List at least 3 sets of imports. What is their purpose (from msdn), and how might the malware use them?
  * IsDebuggerPresent - Returns whether or not the process is running in the context of a debugger. It's probably used as an anti-analysis technique to quit the process at the beginning if it returns true.
  * WriteFile - Writes to a file handle (file, file stream, socket, console buffer, pipe, etc). Probably in conjunction with CreateFileW to write the embedded file to disk.
  * `_register_onexit_function` - Manages the routines to be called at exit time. - Probably used to ensure some sort of cleanup function gets called when the program exits.

* List at least 3 strings that stick out to you and describe how they might relate to malicious activity.
  * "regsvr32 /s C:\Windows\atidrv.dll" - Probably used to register the embedded DLL file in the registry
  * Two instances of "This program cannot be run in DOS mode." - Indicator that it probably has an embedded PE file.
  * CLSID{3543619C-D563-43f7-95EA-4DA7E1CC396A}\\InprocHandler32 - Used to register a custom handler for the application.

* What persistence mechanism is used by this malware? What host-based signatures can you gather from this?
  * Registering an embedded DLL. "regsvr32 /s C:\Windows\atidrv.dll"

* What is the CLSID served by this malware?
  * 3543619C-D563-43f7-95EA-4DA7E1CC396A

* What is the name of the COM interface that this malware makes use of?
  * IWebBrowser2

* What two COM functions does this malware call from the above COM interface, and what are they used for?
  * "Apartment" and "ThreadingModel"

## Lab_03-2.malware
* What is the md5sum? What of interest does VirusTotal report?
  * bf4f5b4ff7ed9c7275496c07f9836028. It reports an invalid PE linker version, long sleeps, a kind of high entropy on the `.text` section, it writes to a fake Java executable, and executes some WMI (Windows Management Instrumentation) commands

* List at least 3 imports or sets of imports you haven't seen before, what is their purpose (from msdn), and how might the malware use them?
  * `IsBadCodePtr` and `IsBadWritePtr`: Determines whether the calling process has read access to the memory at the specified address. There's also a note that it is deprecated.
  * `WSACleanup`: Terminates use of the Winsock 2 DLL (Ws2_32.dll), which contains a bunch of functions for socket operations.
  * `MapViewOfFile`: Maps a view of a file mapping into the address space of a calling process

* List at least 3 strings that stick out to you and describe how they might relate to malicious activity.
  * Java.exe: Writes to a fake Java executable
  * CreateToolhelp32Snapshot: Probably used to monitor some process to wait for a specific state
  * configserver)/r(ndr29(xhhoxxx2)00xAAA...: Maybe used for a buffer overflow attack?

* What persistence mechanism is used by this malware? What host-based signatures can you gather from this?
  * Uses WMI and Disguises itself as the Java executable, which is probably launched pretty often.
  * Host based signatures: java.exe, \\java.exe, GetEnvironmentStrings

* Identified functionality: list processes, interactive remote shell, upload file (from infected machine)
  * What is the address of the subroutine that handles this functionality?
    * List processes: 0x402310
    * Remote shell: 0x402490
    * Upload file: 0x4020f0
  * What is the command ID?
    * List processes: 6
    * Remote shell: 8
    * Upload file: 4
  * Does the subroutine return anything to the attacker, if so, what?
    * List processes: The amount of bytes that it sent
    * Remote shell: The amount of bytes that it uploaded
    * Upload file: The amount of bytes that it uploaded

* Name 3 windows API calls and how they contribute to the functionality
  * List processes:
    * CreateToolhelp32Snapshot: Used to get a snapshot of a process state
    * Process32First: Used to find the first process in the snapshot
    * Process32Next: Used in a loop to find all subsequent processes in the snapshot
  * Remote shell:
    * CreateProcessA: Used to spawn the cmd window
    * CreatePipe: Used to get a pipe to interface with the cmd window
    * ReadFile: Used to read from the read end of the pipe
  * Upload file:
    * CreateFileA: Use it to get a file handle to write to
    * WriteFile: Use it to write the file to the handle
    * CloseHandle: Use it to close the handle after uploading the file

