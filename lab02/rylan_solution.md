### Lab_02-1.malware

1. Main function

   1. What is the address of main:

      1. `0x004011a0` 

         (IDA automatically navigates to the main function, but Ghidra does not - while it was fairly easy to figure it out based on the functions called from `entry`, it might be worth mentioning in the updated slides)

   2. What does this function do?

      1. What code constructs are used in this function?
         1. This function is a simple if/else block based on the return from `InternetCheckConnectionA`
      2. Are there any interesting strings? If so, what are they?
         1. The URL `http://reversing.rocks/` is passed as an argument into `InternetCheckConnectionA`

2. Looking at the subroutine at `0x00401130`:

   1. What are the arguments to `InternetConnectA`? What do they mean?
      1. A handle returned by `InternetOpenA`
      2. The address/IP to connect to
      3. Server port
      4. Username (or protocol specific default if null)
      5. Password (or protocol specific default if null)
      6. Service type (FTP, GOPHER, or HTTP - we're seeing 3, so HTTP)
      7. Flags (we don't have any)
      8. Context
   2. What does this function do?
      1. What code constructs are used in this function?
      2. This function attempts to connect to `reversing.rocks` over HTTP, then passes the connection to a separate function at `0x00401000`. If the connection fails for any reason the program exits abruptly.

3. Looking at the subroutine at `0x00401000`:

   1. What code constructs are used in this function?
      1. An if statement is used to ensure that a hande is created (implying that a file has been found), several do/while loops are used to scan for null terminators to various strings, and a while loop is used to iterate through files. 
   2. What imported functions are called
      1. `FindFirstFileA`
      2. `HttpOpenRequestA`
      3. `HttpSendRequestExA`
      4. `InternetWriteFile`
      5. `FindNextFileA`
      6. `HttpEndRequestA`
      7. `InternetCloseHandle`
      8. `FindClose`
   3. What does this subroutine do?
      1. This function will scan through files on your hard drive, and upload them to `http://reversing.rocks`

4. What does this malware do?

   1. This malware will scan for files on your computer, then upload them to `http://reversing.rocks`



## Lab_02-2.malware

1. Main Function:

   1. What imported functions are called
      1. What do these functions do?
         1. `AllocConsole` - Allocates a console for a new GUI window
         2. `FindWindowA` - Gets a handle to the specified window
         3. `ShowWindow` - Controls attributes about how a window is shown (eg. show window, hide window, etc.)
         4. `fopen` - opens a file
         5. `time` - gets the current time
         6. `fputs` - prints text to the console
         7. `ctime` - A constructor to a class used for formatting time
         8. `fclose` - Closes a file
      2. Any interesting string?
         1. `ConsoleWindowClass` is the window name passed into `FindWindowA`
         2. `\\WINDOWS\\lzwindowlz.av` is the path passed into `fopen`

2. Looking at the subroutine at `0x0040135C`:

   1. What imported functions are called?
      1. `fopen("\\WINDOWS\\lzwindowlz.av", "a+")`
      2. `GetAsyncKeyState`
      3. `MailItPcS_S_S_S_`
   2. What code constructs are used here? (hint, look at the `jmp eax`)
      1. An infinite loop is used to check keys
      2. A switch statement is used to check the value of the key that was pressed (note: this hint probably isn't as necessary now that Ghidra makes a decompiler freely available)

3. What does this malware do?

   â€‹	This malware is a keylogger which emails a log of keys to a hardcoded email address

   1. What signatures would you propose?
      1. Calls to `GetAsyncKeyState` - useful in detecting keyloggers
      2. the email addresses - useful to detect malware interacting with these known bad emails
      3. `\\WINDOWS\\lzwindowlz.av` - used to look for the logged keypresses
   2. Does this sample create any files? If so, what are they used for?
      1. yes, this malware creates a file at `\\WINDOWS\\lzwindowlz.av` and records keypresses in it